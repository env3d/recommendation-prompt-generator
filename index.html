<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recommendation Letter Prompt Generator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background-color: #f7f7f7;
  }
  h1 {
    margin-bottom: 0.5rem;
  }
  #githubLink {
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }
  #githubLink a {
    color: #007acc;
    text-decoration: none;
  }
  #githubLink a:hover {
    text-decoration: underline;
  }
  #candidateInfo {
    font-size: 1.2rem;
    color: #555;
    margin-bottom: 1.5rem;
  }
  
  /* Two-column layout for desktop */
  @media (min-width: 768px) {
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }
    #outputSection {
      position: sticky;
      top: 2rem;
      align-self: start;
    }
  }
  
  label {
    display: block;
    margin-top: 1rem;
    font-weight: bold;
  }
  input, textarea, select {
    width: 100%;
    padding: 0.5rem;
    margin-top: 0.25rem;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  button {
    margin-top: 1.5rem;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 5px;
    background-color: #007acc;
    color: white;
    font-size: 1rem;
    cursor: pointer;
  }
  button:hover {
    background-color: #005f99;
  }
  #output {
    margin-top: 2rem;
    padding: 1rem;
    background-color: #fff;
    border-radius: 5px;
    white-space: pre-wrap;
    border: 1px solid #ccc;
    min-height: 200px;
  }
  #copyButton {
    margin-top: 1rem;
  }
</style>
</head>
<body>

<h1>Recommendation Letter Prompt Generator
<div id="githubLink">
  <a href="https://github.com/env3d/recommendation-prompt-generator" target="_blank">View on GitHub</a>
</div>
</h1>
<div id="candidateInfo"></div>

<div class="container">
  <div id="formSection">
    <form id="recForm">
      <label>Recommender Name
        <input type="text" id="recommenderName" required>
      </label>

      <label>Position / Role
        <input type="text" id="position" required>
      </label>

      <label>Institution / Organization
        <input type="text" id="institution" required>
      </label>

      <label>Length of acquaintance
        <input type="text" id="length" placeholder="e.g., 3 years" required>
      </label>

      <label>Context of interaction
        <select id="interactionContext" multiple>
          <option value="teaching">We taught together in the same department</option>
          <option value="research">Worked on Project together</option>
          <option value="mentee">Candidate was my mentor/teacher</option>
          <option value="mentor">I taught/mentored the candidate</option>
          <option value="other">We collaborated in other ways</option>
        </select>
      </label>

      <label>Additional context
        <input type="text" id="interactionContextExtra" placeholder="e.g., course name, project title, dates">
      </label>

      <label>Notable qualities
        <input type="text" id="qualities" placeholder="e.g., creativity, dedication" required>
      </label>

      <label>Greatest Strength
        <input type="text" id="greatestStrength" placeholder="e.g., leadership, problem-solving" required>
      </label>

      <label>Recommendation strength
        <select id="recommendationStrength">
          <option value="without reservation">Without reservation</option>
          <option value="strongly">Strongly</option>
          <option value="enthusiastically">Enthusiastically</option>
        </select>
      </label>

      <label>Additional Comments
        <textarea id="additionalComments" rows="4" placeholder="Any additional remarks or context"></textarea>
      </label>
    </form>
  </div>

  <div id="outputSection">
    <button type="button" onclick="generatePrompt()">Generate</button>
    <button type="button" onclick="clearForm()">Clear All</button>
    <div id="output"></div>
    <button id="copyButton" style="display: none;" onclick="copyToClipboard()">Copy</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Display candidate name and pronouns
  displayCandidateInfo();
  // Load saved data from local storage
  loadFormData();
});

function displayCandidateInfo() {
  const candidateName = getCandidateNameFromURL();
  const pronouns = getPronounsFromURL();
  const pronounLabel = `${pronouns.subject}/${pronouns.object}/${pronouns.possessiveDet}`;
  
  document.getElementById('candidateInfo').textContent = 
    `Generating recommendation for: ${candidateName} (${pronounLabel})`;
}

function getCandidateNameFromURL() {
  const params = new URLSearchParams(window.location.search);
  const name = params.get('for');
  return (name && name.trim()) ? name.trim() : 'the candidate';
}

// New: derive pronouns from URL (?pronoun=he|she|they)
function getPronounsFromURL() {
  const params = new URLSearchParams(window.location.search);
  const p = (params.get('pronoun') || '').trim().toLowerCase();
  switch (p) {
    case 'he': return { subject: 'he', object: 'him', possessiveDet: 'his', possessive: 'his', reflexive: 'himself' };
    case 'she': return { subject: 'she', object: 'her', possessiveDet: 'her', possessive: 'hers', reflexive: 'herself' };
    case 'they':
    default:
      return { subject: 'they', object: 'them', possessiveDet: 'their', possessive: 'theirs', reflexive: 'themself' };
  }
}

function saveFormData() {
  const formData = {
    recommenderName: document.getElementById('recommenderName').value,
    position: document.getElementById('position').value,
    institution: document.getElementById('institution').value,
    length: document.getElementById('length').value,
    interactionContext: Array.from(document.getElementById('interactionContext').selectedOptions).map(option => option.value),
    interactionContextExtra: document.getElementById('interactionContextExtra').value,
    qualities: document.getElementById('qualities').value,
    greatestStrength: document.getElementById('greatestStrength').value,
    recommendationStrength: document.getElementById('recommendationStrength').value,
    additionalComments: document.getElementById('additionalComments').value,
  };
  localStorage.setItem('recommendationFormData', JSON.stringify(formData));
}

function loadFormData() {
  const savedData = JSON.parse(localStorage.getItem('recommendationFormData'));
  if (savedData) {
    document.getElementById('recommenderName').value = savedData.recommenderName || '';
    document.getElementById('position').value = savedData.position || '';
    document.getElementById('institution').value = savedData.institution || '';
    document.getElementById('length').value = savedData.length || '';
    document.getElementById('qualities').value = savedData.qualities || '';
    document.getElementById('greatestStrength').value = savedData.greatestStrength || '';
    document.getElementById('recommendationStrength').value = savedData.recommendationStrength || '';
    document.getElementById('additionalComments').value = savedData.additionalComments || '';

    const interactionContext = document.getElementById('interactionContext');
    const selected = Array.isArray(savedData.interactionContext) ? savedData.interactionContext : [];
    Array.from(interactionContext.options).forEach(option => {
      option.selected = selected.includes(option.value);
    });

    document.getElementById('interactionContextExtra').value = savedData.interactionContextExtra || '';
  }
}

function clearForm() {
  document.getElementById('recForm').reset();
  localStorage.removeItem('recommendationFormData');
  document.getElementById('output').textContent = '';
  document.getElementById('copyButton').style.display = 'none';
}

function generatePrompt() {
  saveFormData(); // Save form data to local storage

  const v = (id) => (document.getElementById(id).value || '').trim();
  const getSelectedValues = (id) => {
    const opts = document.getElementById(id).selectedOptions;
    return Array.from(opts).map(o => o.value).join(', ');
  };

  const candidateName = getCandidateNameFromURL();
  const pronouns = getPronounsFromURL(); // { subject, object, possessiveDet, possessive, reflexive }

  const sections = [];

  // Recommender Details
  const recLines = [];
  if (v('recommenderName')) recLines.push(`  * Name: ${v('recommenderName')}`);
  if (v('position')) recLines.push(`  * Position / Role: ${v('position')}`);
  if (v('institution')) recLines.push(`  * Institution / Organization: ${v('institution')}`);
  if (recLines.length) {
    sections.push(`Recommender Details:\n${recLines.join('\n')}`);
  }

  // Relationship
  const relLines = [];
  if (v('length')) relLines.push(`  * Length of acquaintance: ${v('length')}`);
  const context = getSelectedValues('interactionContext');
  if (context) relLines.push(`  * Context of interaction: ${context}`);
  if (v('interactionContextExtra')) relLines.push(`  * Additional context: ${v('interactionContextExtra')}`);
  if (relLines.length) {
    sections.push(`Relationship with ${candidateName}:\n${relLines.join('\n')}`);
  }

  // Personal Qualities / Strengths
  const pqLines = [];
  if (v('qualities')) pqLines.push(`  * Notable qualities: ${v('qualities')}`);
  if (v('greatestStrength')) pqLines.push(`  * Greatest strength: ${v('greatestStrength')}`);
  if (pqLines.length) {
    sections.push(`Personal Qualities / Strengths:\n${pqLines.join('\n')}`);
  }

  // Overall Assessment / Recommendation
  const assessLines = [];
  if (v('recommendationStrength')) assessLines.push(`  * Recommendation strength: ${v('recommendationStrength')}`);
  if (assessLines.length) {
    sections.push(`Overall Assessment / Recommendation:\n${assessLines.join('\n')}`);
  }

  // Additional Comments
  if (v('additionalComments')) {
    sections.push(`Additional Comments:\n  ${v('additionalComments')}`);
  }

  const header = `Prompt for LLM: Generate a recommendation letter for ${candidateName} using the information below. Make it professional, enthusiastic, and well-structured.\n`;
  const pronounGuide = `Use these pronouns for ${candidateName}: ${pronouns.subject}/${pronouns.object}/${pronouns.possessiveDet}.`;
  const body = sections.join('\n\n');
  const instruction = `\nInstruction to LLM: Compose a formal recommendation letter incorporating all the above details. Ensure it flows naturally, is enthusiastic without exaggeration, and is suitable for academic or professional contexts. ${pronounGuide}`;

  const prompt = [header, 'Information to include:', '', body, instruction]
    .filter(Boolean)
    .join('\n');

  document.getElementById('output').textContent = prompt;

  // Show the copy button
  document.getElementById('copyButton').style.display = 'block';
}

function copyToClipboard() {
  const output = document.getElementById('output').textContent;
  navigator.clipboard.writeText(output).then(() => {
    alert('Text copied to clipboard!');
  }).catch(err => {
    console.error('Failed to copy text: ', err);
  });
}
</script>

</body>
</html>
